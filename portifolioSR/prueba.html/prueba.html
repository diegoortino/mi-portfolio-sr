<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <style>
    /* Reset y configuración base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  /* Body */
  body {
    background-color: #F5F7F9;
    display: flex;
    flex-direction: column;
    align-content: center;
    justify-content: center;
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 5%;
    font-family: 'Lato', sans-serif;
    line-height: 1.6;
  }

  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    font-family: 'Lato', sans-serif;
    font-size: 1.1rem;
    color: #468FFE;
    background-color: #F8FAFC;
    border-radius: 8px;
    margin: 1rem 0;
  }

  /* Header */
  .header {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    margin-bottom: 1rem;
  }

  .containerTituloHeader {
    width: 100%;
    text-align: center;
  }

  .tituloHeader {
    color: #468FFE;
    font-family: 'Lato', sans-serif;
    cursor: pointer;
    font-size: clamp(1.8rem, 3.8vw, 2.8rem);
    position: relative;
    z-index: 2;
    margin-bottom: 2rem;
    display: inline-block;
    font-weight: 700;
  }

  .tituloHeader::after {
    content: "";
    position: absolute;
    left: -5px;
    bottom: -5px;
    width: calc(100% + 10px);
    height: 12px;
    background: linear-gradient(45deg, #7af08a 0%, #5de06d 100%);
    border-radius: 20px 50px 20px 50px;
    z-index: -1;
    transform: perspective(200px) rotateX(8deg) skewX(-2deg);
    box-shadow: 0 2px 8px rgba(122, 240, 138, 0.3);
  }

  /* Navigation Header */
  .containerNavsHeader {
    display: flex;
    justify-content: center;
    width: 100%;
  }

  .navsLinks {
    width: 80%;
    display: flex;
    flex-direction: row;
    align-items: center;
    justify-content: space-between;
    list-style: none;
  }

  .navLink {
    font-family: 'Lato', sans-serif;
    font-size: clamp(1.2rem, 2vw, 1.5rem);
    line-height: 1.5;
    font-weight: 900;
    color: #070707;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    padding: 8px 0;
  }

  .navLink::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, #468FFE, #070707);
    transition: width 0.3s ease;
  }

  .navLink:hover {
    color: #468FFE;
  }

  .navLink:hover::after {
    width: 100%;
  }

  .navLink:focus {
    outline: 2px solid #468FFE;
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* Main Container */
  .containerMain {
    background-color: #468FFE;
    padding: 2rem;
    border-radius: 20px;
    margin-bottom: 3rem;
    display: flex;
    flex-direction: column;
    align-items: left;
    box-shadow: 0 4px 20px rgba(70, 143, 254, 0.3);
  }

  /* Secciones principales - ocultas por defecto */
  .seccionUsuarios,
  .seccionLicencias,
  .seccionVacaciones {
    display: none;
    width: 100%;
  }

  /* Header de secciones */
  .containerHeaderSeccion {
    display: flex;
    flex-direction: column;
    margin-bottom: 2rem;
  }

  .divTituloSeccion {
    display: flex;
    flex-direction: column;
    align-items: baseline;
    justify-content: left;
    margin-left: 5px;
    margin-bottom: 1rem;
  }

  .tituloSeccion {
    font-family: 'Lato', sans-serif;
    font-size: clamp(1.67rem, 3.33vw, 2.33rem);
    color: #FFFFFF;
    position: relative;
    z-index: 2;
    margin-right: 15px;
    font-weight: 700;
    display: inline-block;
  }

  .tituloSeccion::after {
    content: "";
    position: absolute;
    left: -5px;
    bottom: -5px;
    width: calc(100% + 10px);
    height: 12px;
    background: linear-gradient(45deg, #7af08a 0%, #5de06d 100%);
    border-radius: 20px 50px 20px 50px;
    z-index: -1;
    transform: perspective(200px) rotateX(8deg) skewX(-2deg);
    box-shadow: 0 2px 8px rgba(122, 240, 138, 0.4);
  }

  .subtituloSeccion {
    font-family: 'Lato', sans-serif;
    font-size: clamp(1rem, 1.8vw, 1.5rem);
    color: #070707;
    margin-left: 10px;
    font-weight: 700;
  }

  /* Navegación de secciones */
  .containerNavHeaderSeccion {
    display: flex;
    flex-direction: row;
    justify-content: left;
    width: 100%;
    gap: 10px;
    flex-wrap: wrap;
  }

  .btnNavHeaderSeccion {
    background-color: #7af08a;
    border: none;
    color: #070707;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Lato', sans-serif;
    font-size: clamp(0.83rem, 1.5vw, 1rem);
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .btnNavHeaderSeccion:hover {
    background-color: #5de06d;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .btnNavHeaderSeccion:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  /* Container principal de secciones */
  .containerMainSeccion {
    width: 100%;
  }

  /* Subsecciones - ocultas por defecto */
  .seccionVista,
  .seccionAgregar,
  .seccionModificar,
  .seccionEliminar {
    display: none;
    background-color: #FFFFFF;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  /* Header interno de subsecciones */
  .containerHeaderInternoSeccion {
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid #F5F7F9;
  }

  .tituloInternoSeccion {
    font-family: 'Lato', sans-serif;
    font-size: clamp(1.2rem, 2.2vw, 1.8rem);
    color: #070707;
    margin-bottom: 1rem;
    font-weight: 700;
  }

  /* Container principal interno */
  .containerMainInternoSeccion {
    width: 100%;
  }

  /* Labels y selects */
  label {
    font-family: 'Lato', sans-serif;
    font-size: clamp(0.9rem, 1.4vw, 1.1rem);
    color: #070707;
    font-weight: 600;
    margin-bottom: 0.5rem;
    margin-top: 1rem;
    display: block;
  }

  label:first-of-type {
    margin-top: 0;
  }

  select,
  input[type="text"],
  input[type="email"],
  input[type="date"],
  input[type="number"],
  textarea {
    width: 100%;
    max-width: 400px;
    padding: 10px 12px;
    border: 2px solid #E1E8ED;
    border-radius: 8px;
    font-family: 'Lato', sans-serif;
    font-size: 1rem;
    background-color: #FFFFFF;
    transition: all 0.3s ease;
    margin-bottom: 0.5rem;
  }

  select:focus,
  input:focus,
  textarea:focus {
    outline: none;
    border-color: #468FFE;
    box-shadow: 0 0 0 3px rgba(70, 143, 254, 0.1);
  }

  textarea {
    resize: vertical;
    min-height: 80px;
  }

  /* Formularios */
  .formularioAgregarUsuario,
  .formularioModificarUsuario,
  .formularioAgregarAusencia,
  .formularioModificarAusencia,
  .formularioAgregarVacacion,
  .formularioModificarVacacion {
    display: flex;
    flex-direction: column;
    max-width: 60%;
    padding: 5px;
  }

  /* Botones de formularios */
  button[type="submit"] {
    background-color: #468FFE;
    color: #FFFFFF;
    border: none;
    padding: 12px 24px;
    border-radius: 8px;
    font-family: 'Lato', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    margin-top: 1.5rem;
    transition: all 0.3s ease;
    max-width: 200px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  button[type="submit"]:hover {
    background-color: #3a7ae0;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  button[type="submit"]:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  /* Containers de tarjetas */
  .containerTarjetasSeccionVista {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .containerTarjetaUsuario,
  .containerTarjetaAusencia,
  .containerTarjetaVacacion {
    background-color: #F8FAFC;
    border: 2px solid #E1E8ED;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
  }

  .nombreUsuario,
  .equipoUsuario,
  .supervisorUsuario,
  .motivoAusencia,
  .fechaInicioAusencia,
  .fechaFinAusencia,
  .usuarioAusencia,
  .fechaInicioVacacion,
  .fechaFinVacacion,
  .diasVacacion,
  .usuarioVacacion,
  .observacionesVacacion {
    font-family: 'Lato', sans-serif;
    color: #070707;
    margin-bottom: 0.8rem;
    padding: 8px 12px;
    background-color: #FFFFFF;
    border-radius: 6px;
    font-weight: 500;
  }

  /* Botones de eliminar */
  .botonEliminarUsuario,
  .botonEliminarAusencia,
  .botonEliminarVacacion {
    background-color: #E53E3E;
    color: #FFFFFF;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    font-family: 'Lato', sans-serif;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    margin-top: 1rem;
    transition: all 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  .botonEliminarUsuario:hover,
  .botonEliminarAusencia:hover,
  .botonEliminarVacacion:hover {
    background-color: #C53030;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }

  .botonEliminarUsuario:active,
  .botonEliminarAusencia:active,
  .botonEliminarVacacion:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  /* Loading */
  .loading {
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    font-family: 'Lato', sans-serif;
    font-size: 1.1rem;
    color: #468FFE;
    background-color: #F8FAFC;
    border-radius: 8px;
    margin: 1rem 0;
  }

  /* Footer */
  footer {
    margin-top: 2rem;
    padding: 1rem;
    text-align: center;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    body {
      padding: 0 3%;
    }
    
    .containerMain {
      padding: 1rem;
    }
    
    .navsLinks {
      width: 100%;
      flex-direction: column;
      gap: 0.5rem;
    }
    
    .navLink {
      text-align: center;
      padding: 10px;
    }
    
    .containerNavHeaderSeccion {
      justify-content: center;
      gap: 8px;
    }
    
    .btnNavHeaderSeccion {
      padding: 8px 16px;
      font-size: 0.9rem;
    }
    
    .formularioAgregarUsuario,
    .formularioModificarUsuario,
    .formularioAgregarAusencia,
    .formularioModificarAusencia,
    .formularioAgregarVacacion,
    .formularioModificarVacacion {
      max-width: 100%;
    }
    
    .containerTarjetasSeccionVista {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .containerNavHeaderSeccion {
      flex-direction: column;
      align-items: center;
    }
    
    .btnNavHeaderSeccion {
      width: 100%;
      max-width: 250px;
    }
    
    select,
    input[type="text"],
    input[type="email"],
    input[type="date"],
    input[type="number"],
    textarea {
      max-width: 100%;
    }
  }

  /* Estados activos para navegación */
  .navLink.active {
    color: #468FFE;
  }

  .navLink.active::after {
    width: 100%;
  }

  .btnNavHeaderSeccion.active {
    background-color: #5de06d;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  /* Animaciones suaves */
  .seccionUsuarios,
  .seccionLicencias,
  .seccionVacaciones {
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .seccionUsuarios[style*="block"],
  .seccionLicencias[style*="block"],
  .seccionVacaciones[style*="block"] {
    opacity: 1;
  }

  /* Efectos de hover mejorados */
  .containerTarjetaUsuario:hover,
  .containerTarjetaAusencia:hover,
  .containerTarjetaVacacion:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
  }
  </style>
  <title>Gestion Supers</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
  <header class="header">
    <div class="containerTituloHeader">
      <h1 class="tituloHeader">Proyecto Matcheador - Gestión Supers</h1>
    </div>
    <nav class="containerNavsHeader">
      <ul class="navsLinks">
        <li class="navLink" id="btnUsuariosHeader">Usuarios</li>      
        <li class="navLink" id="btnLicenciasHeader">Licencias</li>
        <li class="navLink" id="btnVacacionesHeader">Vacaciones</li>
      </ul>
    </nav>    
  </header>

  <main id="main">
    <div class="containerMain">

      <!-- SECCIÓN USUARIOS -->
      <section class="seccionUsuarios">
        <div class="containerHeaderSeccion">
          <div class="divTituloSeccion">
            <h2 class="tituloSeccion">Usuarios</h2>
            <p class="subtituloSeccion">Gestiona los usuarios del proyecto.</p>
          </div>
          <div class="containerNavHeaderSeccion">
            <button class="btnNavHeaderSeccion" id="btnVerUsuarios">Ver Usuarios</button>
            <button class="btnNavHeaderSeccion" id="btnAgregarUsuario">Agregar Usuario</button>
            <button class="btnNavHeaderSeccion" id="btnModificarUsuario">Modificar Usuario</button>
            <button class="btnNavHeaderSeccion" id="btnEliminarUsuario">Eliminar Usuario</button>
          </div>
        </div>
        <div class="containerMainSeccion">

          <!-- Ver Usuarios -->
          <section class="seccionVista" id="seccionVistaUsuarios">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Ver Usuarios</h2>
              <label for="desplegablePorEquipoUsuarios" id="labelDesplegablePorEquipoUsuarios">Filtra por equipo:</label>
              <select id="desplegablePorEquipoUsuarios" name="desplegablePorEquipoUsuarios">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioUsuarios" id="labelDesplegablePorUsuarioUsuarios">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioUsuarios" name="desplegablePorUsuarioUsuarios">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <div class="containerTarjetasSeccionVista" id="containerTarjetasUsuarios">
                <!-- Contenido dinámico de vista de usuario -->
              </div>
            </div>
          </section>

          <!-- Agregar Usuario -->
          <section class="seccionAgregar" id="seccionAgregarUsuario">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Agregar Usuario</h2>
            </div>
            <div class="containerMainInternoSeccion">
              <form action="/submit" method="POST" class="formularioAgregarUsuario">
                <label for="user_name">Nombre completo:</label>
                <input type="text" id="user_name" name="user_name" required>

                <label for="user_meli">User Meli:</label>
                <input type="text" id="user_meli" name="user_meli" required>

                <label for="user_team">Equipo:</label>
                <select id="user_team" name="user_team" required>
                  <option value="">-- Selecciona un equipo --</option>
                  <!-- opciones traídas de la db -->
                </select>

                <label for="user_leader">Supervisor:</label>
                <input type="text" id="user_leader" name="user_leader" required>

                <label for="user_cuil">CUIL:</label>
                <input type="text" id="user_cuil" name="user_cuil">

                <label for="user_position">Posición:</label>
                <input type="text" id="user_position" name="user_position" required>

                <label for="user_mail">Correo de MeLi:</label>
                <input type="email" id="user_mail" name="user_mail">

                <label for="user_serial">Serial Equipo:</label>
                <input type="text" id="user_serial" name="user_serial">

                <label for="user_entry_date">Fecha de ingreso:</label>
                <input type="date" id="user_entry_date" name="user_entry_date" required>

                <label for="user_retirement_date">Fecha de egreso:</label>
                <input type="date" id="user_retirement_date" name="user_retirement_date">

                <label for="user_expiration_date">Fecha de expiración cuenta MeLi:</label>
                <input type="date" id="user_expiration_date" name="user_expiration_date">

                <button type="submit">Enviar</button>
              </form>
            </div>
          </section>

          <!-- Modificar Usuario -->
          <section class="seccionModificar" id="seccionModificarUsuario">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Modificar Usuario</h2>
              <label for="desplegablePorEquipoModificarUsuario" id="labelDesplegablePorEquipoModificarUsuario">Filtra por equipo:</label>
              <select id="desplegablePorEquipoModificarUsuario" name="desplegablePorEquipoModificarUsuario">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioModificarUsuario" id="labelDesplegablePorUsuarioModificarUsuario">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioModificarUsuario" name="desplegablePorUsuarioModificarUsuario">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <form action="/submit" method="PUT" class="formularioModificarUsuario">
                <label for="modify_user_name">Nombre completo:</label>
                <input type="text" id="modify_user_name" name="modify_user_name" required>

                <label for="modify_user_meli">User Meli:</label>
                <input type="text" id="modify_user_meli" name="modify_user_meli" required>

                <label for="modify_user_team">Equipo:</label>
                <select id="modify_user_team" name="modify_user_team" required>
                  <option value="">-- Selecciona un equipo --</option>
                  <!-- opciones traídas de la db -->
                </select>

                <label for="modify_user_leader">Supervisor:</label>
                <input type="text" id="modify_user_leader" name="modify_user_leader" required>

                <label for="modify_user_cuil">CUIL:</label>
                <input type="text" id="modify_user_cuil" name="modify_user_cuil">

                <label for="modify_user_position">Posición:</label>
                <input type="text" id="modify_user_position" name="modify_user_position" required>

                <label for="modify_user_mail">Correo de MeLi:</label>
                <input type="email" id="modify_user_mail" name="modify_user_mail">

                <label for="modify_user_serial">Serial Equipo:</label>
                <input type="text" id="modify_user_serial" name="modify_user_serial">

                <label for="modify_user_entry_date">Fecha de ingreso:</label>
                <input type="date" id="modify_user_entry_date" name="modify_user_entry_date" required>

                <label for="modify_user_retirement_date">Fecha de egreso:</label>
                <input type="date" id="modify_user_retirement_date" name="modify_user_retirement_date">

                <label for="modify_user_expiration_date">Fecha de expiración cuenta MeLi:</label>
                <input type="date" id="modify_user_expiration_date" name="modify_user_expiration_date">

                <button type="submit">Actualizar</button>
              </form>
            </div>
          </section>

          <!-- Eliminar Usuario -->
          <section class="seccionEliminar" id="seccionEliminarUsuario">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Eliminar Usuario</h2>
              <label for="desplegablePorEquipoEliminarUsuario" id="labelDesplegablePorEquipoEliminarUsuario">Filtra por equipo:</label>
              <select id="desplegablePorEquipoEliminarUsuario" name="desplegablePorEquipoEliminarUsuario">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioEliminarUsuario" id="labelDesplegablePorUsuarioEliminarUsuario">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioEliminarUsuario" name="desplegablePorUsuarioEliminarUsuario">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <div class="containerTarjetaUsuario">
                <div class="nombreUsuario"><!-- Esta información, según sea el usuario elegido, será traída de la db --></div>
                <div class="equipoUsuario"><!-- Esta información, según sea el usuario elegido, será traída de la db --></div>
                <div class="supervisorUsuario"><!-- Esta información, según sea el usuario elegido, será traída de la db --></div>
              </div>
              <button class="botonEliminarUsuario">Eliminar Usuario</button>
            </div>
          </section>

        </div>
      </section>

      <!-- SECCIÓN LICENCIAS/AUSENCIAS -->
      <section class="seccionLicencias">
        <div class="containerHeaderSeccion">
          <div class="divTituloSeccion">
            <h2 class="tituloSeccion">Licencias/Ausencias</h2>
            <p class="subtituloSeccion">Gestiona las licencias y ausencias de los usuarios.</p>
          </div>
          <div class="containerNavHeaderSeccion">
            <button class="btnNavHeaderSeccion" id="btnVerAusencias">Ver Ausencias</button>
            <button class="btnNavHeaderSeccion" id="btnAgregarAusencia">Agregar Ausencia</button>
            <button class="btnNavHeaderSeccion" id="btnModificarAusencia">Modificar Ausencia</button>
            <button class="btnNavHeaderSeccion" id="btnEliminarAusencia">Eliminar Ausencia</button>
          </div>
        </div>
        <div class="containerMainSeccion">

          <!-- Ver Ausencias -->
          <section class="seccionVista" id="seccionVistaAusencias">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Ver Licencias/Ausencias de los Usuarios</h2>
              <label for="desplegablePorEquipoAusencias" id="labelDesplegablePorEquipoAusencias">Filtra por equipo:</label>
              <select id="desplegablePorEquipoAusencias" name="desplegablePorEquipoAusencias">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioAusencias" id="labelDesplegablePorUsuarioAusencias">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioAusencias" name="desplegablePorUsuarioAusencias">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <div class="containerTarjetasSeccionVista" id="containerTarjetasAusencias">
                <!-- Contenido dinámico de vista de Licencias -->
              </div>
            </div>
          </section>

          <!-- Agregar Ausencia -->
          <section class="seccionAgregar" id="seccionAgregarAusencia">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Agregar Ausencia</h2>
              <label for="desplegablePorEquipoAgregarAusencia" id="labelDesplegablePorEquipoAgregarAusencia">Filtra por equipo:</label>
              <select id="desplegablePorEquipoAgregarAusencia" name="desplegablePorEquipoAgregarAusencia">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioAgregarAusencia" id="labelDesplegablePorUsuarioAgregarAusencia">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioAgregarAusencia" name="desplegablePorUsuarioAgregarAusencia">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <form action="/submit" method="POST" class="formularioAgregarAusencia">
                <label for="absence_detail">Motivo de ausencia:</label>
                <select id="absence_detail" name="absence_detail" required>
                  <option value="">-- Selecciona una opción --</option>
                  <option value="estudio">Día de estudio</option>
                  <option value="no_remunerativo">Día no remunerativo</option>
                  <option value="duchando">Se está duchando</option>
                  <option value="otro">Otro</option>
                </select>

                <label for="absence_init_date">Fecha de inicio:</label>
                <input type="date" id="absence_init_date" name="absence_init_date" required>

                <label for="absence_end_date">Fecha de finalización:</label>
                <input type="date" id="absence_end_date" name="absence_end_date" required>

                <button type="submit">Enviar</button>
              </form>
            </div>
          </section>

          <!-- Modificar Ausencia -->
          <section class="seccionModificar" id="seccionModificarAusencia">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Modificar Ausencia</h2>
              <label for="desplegablePorEquipoModificarAusencia" id="labelDesplegablePorEquipoModificarAusencia">Filtra por equipo:</label>
              <select id="desplegablePorEquipoModificarAusencia" name="desplegablePorEquipoModificarAusencia">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioModificarAusencia" id="labelDesplegablePorUsuarioModificarAusencia">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioModificarAusencia" name="desplegablePorUsuarioModificarAusencia">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <form action="/submit" method="PUT" class="formularioModificarAusencia">
                <label for="modify_absence_detail">Motivo de ausencia:</label>
                <select id="modify_absence_detail" name="modify_absence_detail" required>
                  <option value="">-- Selecciona una opción --</option>
                  <option value="estudio">Día de estudio</option>
                  <option value="no_remunerativo">Día no remunerativo</option>
                  <option value="duchando">Se está duchando</option>
                  <option value="otro">Otro</option>
                </select>

                <label for="modify_absence_init_date">Fecha de inicio:</label>
                <input type="date" id="modify_absence_init_date" name="modify_absence_init_date" required>

                <label for="modify_absence_end_date">Fecha de finalización:</label>
                <input type="date" id="modify_absence_end_date" name="modify_absence_end_date" required>

                <button type="submit">Actualizar</button>
              </form>
            </div>
          </section>

          <!-- Eliminar Ausencia -->
          <section class="seccionEliminar" id="seccionEliminarAusencia">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Eliminar Ausencia</h2>
              <label for="desplegablePorEquipoEliminarAusencia" id="labelDesplegablePorEquipoEliminarAusencia">Filtra por equipo:</label>
              <select id="desplegablePorEquipoEliminarAusencia" name="desplegablePorEquipoEliminarAusencia">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioEliminarAusencia" id="labelDesplegablePorUsuarioEliminarAusencia">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioEliminarAusencia" name="desplegablePorUsuarioEliminarAusencia">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <div class="containerTarjetaAusencia">
                <div class="motivoAusencia"><!-- Esta información, según sea la ausencia elegida, será traída de la db --></div>
                <div class="fechaInicioAusencia"><!-- Esta información, según sea la ausencia elegida, será traída de la db --></div>
                <div class="fechaFinAusencia"><!-- Esta información, según sea la ausencia elegida, será traída de la db --></div>
                <div class="usuarioAusencia"><!-- Esta información, según sea la ausencia elegida, será traída de la db --></div>
              </div>
              <button class="botonEliminarAusencia">Eliminar Ausencia</button>
            </div>
          </section>

        </div>
      </section>

      <!-- SECCIÓN VACACIONES -->
      <section class="seccionVacaciones">
        <div class="containerHeaderSeccion">
          <div class="divTituloSeccion">
            <h2 class="tituloSeccion">Vacaciones</h2>
            <p class="subtituloSeccion">Gestiona las vacaciones de los usuarios.</p>
          </div>
          <div class="containerNavHeaderSeccion">
            <button class="btnNavHeaderSeccion" id="btnVerVacaciones">Ver Vacaciones</button>
            <button class="btnNavHeaderSeccion" id="btnAgregarVacacion">Agregar Vacación</button>
            <button class="btnNavHeaderSeccion" id="btnModificarVacacion">Modificar Vacación</button>
            <button class="btnNavHeaderSeccion" id="btnEliminarVacacion">Eliminar Vacación</button>
          </div>
        </div>
        <div class="containerMainSeccion">

          <!-- Ver Vacaciones -->
          <section class="seccionVista" id="seccionVistaVacaciones">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Ver Vacaciones de los Usuarios</h2>
              <label for="desplegablePorEquipoVacaciones" id="labelDesplegablePorEquipoVacaciones">Filtra por equipo:</label>
              <select id="desplegablePorEquipoVacaciones" name="desplegablePorEquipoVacaciones">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioVacaciones" id="labelDesplegablePorUsuarioVacaciones">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioVacaciones" name="desplegablePorUsuarioVacaciones">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <div class="containerTarjetasSeccionVista" id="containerTarjetasVacaciones">
                <!-- Contenido dinámico de vista de vacaciones -->
              </div>
            </div>
          </section>

          <!-- Agregar Vacación -->
          <section class="seccionAgregar" id="seccionAgregarVacacion">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Agregar Vacación</h2>
              <label for="desplegablePorEquipoAgregarVacacion" id="labelDesplegablePorEquipoAgregarVacacion">Filtra por equipo:</label>
              <select id="desplegablePorEquipoAgregarVacacion" name="desplegablePorEquipoAgregarVacacion">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioAgregarVacacion" id="labelDesplegablePorUsuarioAgregarVacacion">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioAgregarVacacion" name="desplegablePorUsuarioAgregarVacacion">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <form action="/submit" method="POST" class="formularioAgregarVacacion">
                <label for="vacation_init_date">Fecha de inicio:</label>
                <input type="date" id="vacation_init_date" name="vacation_init_date" required>

                <label for="vacation_end_date">Fecha de finalización:</label>
                <input type="date" id="vacation_end_date" name="vacation_end_date" required>

                <label for="vacation_days">Días de vacación:</label>
                <input type="number" id="vacation_days" name="vacation_days" min="1" required>

                <label for="vacation_observations">Observaciones:</label>
                <textarea id="vacation_observations" name="vacation_observations" rows="3"></textarea>

                <button type="submit">Enviar</button>
              </form>
            </div>
          </section>

          <!-- Modificar Vacación -->
          <section class="seccionModificar" id="seccionModificarVacacion">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Modificar Vacación</h2>
              <label for="desplegablePorEquipoModificarVacacion" id="labelDesplegablePorEquipoModificarVacacion">Filtra por equipo:</label>
              <select id="desplegablePorEquipoModificarVacacion" name="desplegablePorEquipoModificarVacacion">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioModificarVacacion" id="labelDesplegablePorUsuarioModificarVacacion">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioModificarVacacion" name="desplegablePorUsuarioModificarVacacion">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <form action="/submit" method="PUT" class="formularioModificarVacacion">
                <label for="modify_vacation_init_date">Fecha de inicio:</label>
                <input type="date" id="modify_vacation_init_date" name="modify_vacation_init_date" required>

                <label for="modify_vacation_end_date">Fecha de finalización:</label>
                <input type="date" id="modify_vacation_end_date" name="modify_vacation_end_date" required>

                <label for="modify_vacation_days">Días de vacación:</label>
                <input type="number" id="modify_vacation_days" name="modify_vacation_days" min="1" required>

                <label for="modify_vacation_observations">Observaciones:</label>
                <textarea id="modify_vacation_observations" name="modify_vacation_observations" rows="3"></textarea>

                <button type="submit">Actualizar</button>
              </form>
            </div>
          </section>

          <!-- Eliminar Vacación -->
          <section class="seccionEliminar" id="seccionEliminarVacacion">
            <div class="containerHeaderInternoSeccion">
              <h2 class="tituloInternoSeccion">Eliminar Vacación</h2>
              <label for="desplegablePorEquipoEliminarVacacion" id="labelDesplegablePorEquipoEliminarVacacion">Filtra por equipo:</label>
              <select id="desplegablePorEquipoEliminarVacacion" name="desplegablePorEquipoEliminarVacacion">
                <option value="">-- Selecciona un equipo --</option>
                <!-- opciones traídas de la db -->
              </select>
              <label for="desplegablePorUsuarioEliminarVacacion" id="labelDesplegablePorUsuarioEliminarVacacion">Filtra por usuario:</label>
              <select id="desplegablePorUsuarioEliminarVacacion" name="desplegablePorUsuarioEliminarVacacion">
                <option value="">-- Selecciona un usuario --</option>
                <!-- opciones traídas de la db -->
              </select>
            </div>
            <div class="containerMainInternoSeccion">
              <div class="containerTarjetaVacacion">
                <div class="fechaInicioVacacion"><!-- Esta información, según sea la vacación elegida, será traída de la db --></div>
                <div class="fechaFinVacacion"><!-- Esta información, según sea la vacación elegida, será traída de la db --></div>
                <div class="diasVacacion"><!-- Esta información, según sea la vacación elegida, será traída de la db --></div>
                <div class="usuarioVacacion"><!-- Esta información, según sea la vacación elegida, será traída de la db --></div>
                <div class="observacionesVacacion"><!-- Esta información, según sea la vacación elegida, será traída de la db --></div>
              </div>
              <button class="botonEliminarVacacion">Eliminar Vacación</button>
            </div>
          </section>

        </div>
      </section>

    </div>
  </main>

  <footer>
  </footer>

<script>

  // ============================================
// GESTIÓN DE NAVEGACIÓN PRINCIPAL
// ============================================

document.addEventListener('DOMContentLoaded', () => {
    initializeApp();
});

// FUNCIÓN PRINCIPAL DE INICIALIZACIÓN - CORREGIDA
function initializeApp() {
    setupMainNavigation();
    setupSectionNavigation();
    setupFormHandlers();
    showInitialSection();
    loadInitialData();
}

// FUNCIÓN UNIFICADA PARA CARGAR DATOS INICIALES - CORREGIDA
function loadInitialData() {
    loadUsers();
    loadTeams();
    loadAbsences();
    loadVacations();
}

// Navegación principal entre secciones
function setupMainNavigation() {
    const btnUsuariosHeader = document.getElementById('btnUsuariosHeader');
    const btnLicenciasHeader = document.getElementById('btnLicenciasHeader');
    const btnVacacionesHeader = document.getElementById('btnVacacionesHeader');
    
    const seccionUsuarios = document.querySelector('.seccionUsuarios');
    const seccionLicencias = document.querySelector('.seccionLicencias');
    const seccionVacaciones = document.querySelector('.seccionVacaciones');
    
    // Event listeners para navegación principal
    btnUsuariosHeader?.addEventListener('click', () => {
        showMainSection(seccionUsuarios);
        setActiveMainNav(btnUsuariosHeader);
        showSubSection('seccionVistaUsuarios');
        setActiveSubNav('btnVerUsuarios');
    });
    
    btnLicenciasHeader?.addEventListener('click', () => {
        showMainSection(seccionLicencias);
        setActiveMainNav(btnLicenciasHeader);
        showSubSection('seccionVistaAusencias');
        setActiveSubNav('btnVerAusencias');
    });
    
    btnVacacionesHeader?.addEventListener('click', () => {
        showMainSection(seccionVacaciones);
        setActiveMainNav(btnVacacionesHeader);
        showSubSection('seccionVistaVacaciones');
        setActiveSubNav('btnVerVacaciones');
    });
}

function showMainSection(activeSection) {
    const allMainSections = ['.seccionUsuarios', '.seccionLicencias', '.seccionVacaciones'];
    
    allMainSections.forEach(selector => {
        const section = document.querySelector(selector);
        if (section) {
            section.style.display = 'none';
        }
    });
    
    if (activeSection) {
        activeSection.style.display = 'block';
    }
}

function setActiveMainNav(activeButton) {
    const allNavButtons = document.querySelectorAll('.navLink');
    allNavButtons.forEach(btn => btn.classList.remove('active'));
    
    if (activeButton) {
        activeButton.classList.add('active');
    }
}

function showInitialSection() {
    const seccionUsuarios = document.querySelector('.seccionUsuarios');
    const btnUsuariosHeader = document.getElementById('btnUsuariosHeader');
    
    showMainSection(seccionUsuarios);
    setActiveMainNav(btnUsuariosHeader);
    showSubSection('seccionVistaUsuarios');
    setActiveSubNav('btnVerUsuarios');
}

// ============================================
// GESTIÓN DE NAVEGACIÓN DE SUBSECCIONES
// ============================================

function setupSectionNavigation() {
    // Usuarios
    setupSubNavigation([
        { btn: 'btnVerUsuarios', section: 'seccionVistaUsuarios' },
        { btn: 'btnAgregarUsuario', section: 'seccionAgregarUsuario' },
        { btn: 'btnModificarUsuario', section: 'seccionModificarUsuario' },
        { btn: 'btnEliminarUsuario', section: 'seccionEliminarUsuario' }
    ]);
    
    // Licencias/Ausencias
    setupSubNavigation([
        { btn: 'btnVerAusencias', section: 'seccionVistaAusencias' },
        { btn: 'btnAgregarAusencia', section: 'seccionAgregarAusencia' },
        { btn: 'btnModificarAusencia', section: 'seccionModificarAusencia' },
        { btn: 'btnEliminarAusencia', section: 'seccionEliminarAusencia' }
    ]);
    
    // Vacaciones
    setupSubNavigation([
        { btn: 'btnVerVacaciones', section: 'seccionVistaVacaciones' },
        { btn: 'btnAgregarVacacion', section: 'seccionAgregarVacacion' },
        { btn: 'btnModificarVacacion', section: 'seccionModificarVacacion' },
        { btn: 'btnEliminarVacacion', section: 'seccionEliminarVacacion' }
    ]);
}

function setupSubNavigation(navigationItems) {
    navigationItems.forEach(item => {
        const button = document.getElementById(item.btn);
        if (button) {
            button.addEventListener('click', () => {
                showSubSection(item.section);
                setActiveSubNav(item.btn);
            });
        }
    });
}

function showSubSection(activeSectionId) {
    // Lista de todas las posibles subsecciones
    const allSubSections = [
        'seccionVistaUsuarios', 'seccionAgregarUsuario', 'seccionModificarUsuario', 'seccionEliminarUsuario',
        'seccionVistaAusencias', 'seccionAgregarAusencia', 'seccionModificarAusencia', 'seccionEliminarAusencia',
        'seccionVistaVacaciones', 'seccionAgregarVacacion', 'seccionModificarVacacion', 'seccionEliminarVacacion'
    ];
    
    // Ocultar todas las subsecciones
    allSubSections.forEach(sectionId => {
        const section = document.getElementById(sectionId);
        if (section) {
            section.style.display = 'none';
        }
    });
    
    // Mostrar la subsección activa
    const activeSection = document.getElementById(activeSectionId);
    if (activeSection) {
        activeSection.style.display = 'block';
    }
}

function setActiveSubNav(activeButtonId) {
    const allSubNavButtons = document.querySelectorAll('.btnNavHeaderSeccion');
    allSubNavButtons.forEach(btn => btn.classList.remove('active'));
    
    const activeButton = document.getElementById(activeButtonId);
    if (activeButton) {
        activeButton.classList.add('active');
    }
}

// ============================================
// VARIABLES GLOBALES UNIFICADAS - CORREGIDA
// ============================================

var selectedUserIds = {
    modify: null,
    delete: null
};

var selectedAbsenceIds = {
    modify: null,
    delete: null
};

var selectedVacationIds = {
    modify: null,
    delete: null
};

// ============================================
// FUNCIONES DE VISUALIZACIÓN
// ============================================

function displayUsers(users) {
    const container = document.getElementById('containerTarjetasUsuarios');
    if (!container) return;
    
    if (!users || users.length === 0) {
        container.innerHTML = '<p>No hay usuarios registrados</p>';
        return;
    }
    
    container.innerHTML = users.map(user => `
        <div class="containerTarjetaUsuario" data-user-id="${user.user_id}">
            <div class="nombreUsuario">Nombre: ${user.user_name || 'N/A'}</div>
            <div class="equipoUsuario">Equipo: ${user.user_team || 'N/A'}</div>
            <div class="supervisorUsuario">Supervisor: ${user.user_leader || 'N/A'}</div>
            <div class="nombreUsuario">User Meli: ${user.user_meli || 'N/A'}</div>
            <div class="nombreUsuario">Posición: ${user.user_position || 'N/A'}</div>
            <div class="nombreUsuario">Email: ${user.user_mail || 'N/A'}</div>
            <div class="nombreUsuario">Fecha Ingreso: ${user.user_entry_date || 'N/A'}</div>
            <div class="nombreUsuario">Estado: ${user.user_status || 'Activo'}</div>
        </div>
    `).join('');
}

function displayAbsences(absences) {
    const container = document.getElementById('containerTarjetasAusencias');
    if (!container) return;
    
    if (!absences || absences.length === 0) {
        container.innerHTML = '<p>No hay ausencias registradas</p>';
        return;
    }
    
    container.innerHTML = absences.map(absence => `
        <div class="containerTarjetaAusencia" data-absence-id="${absence.absence_id}">
            <div class="motivoAusencia">Motivo: ${absence.absence_detail || 'N/A'}</div>
            <div class="fechaInicioAusencia">Fecha Inicio: ${absence.absence_init_date || 'N/A'}</div>
            <div class="fechaFinAusencia">Fecha Fin: ${absence.absence_end_date || 'N/A'}</div>
            <div class="usuarioAusencia">Usuario: ${absence.user_name || 'N/A'}</div>
            <div class="usuarioAusencia">Equipo: ${absence.user_team || 'N/A'}</div>
            <div class="usuarioAusencia">Supervisor: ${absence.user_leader || 'N/A'}</div>
        </div>
    `).join('');
}

function displayVacations(vacations) {
    const container = document.getElementById('containerTarjetasVacaciones');
    if (!container) return;
    
    if (!vacations || vacations.length === 0) {
        container.innerHTML = '<p>No hay vacaciones registradas</p>';
        return;
    }
    
    container.innerHTML = vacations.map(vacation => `
        <div class="containerTarjetaVacacion" data-vacation-id="${vacation.vacation_id}">
            <div class="fechaInicioVacacion">Fecha Inicio: ${vacation.vacation_init_date || 'N/A'}</div>
            <div class="fechaFinVacacion">Fecha Fin: ${vacation.vacation_end_date || 'N/A'}</div>
            <div class="diasVacacion">Días: ${vacation.vacation_days || 'N/A'}</div>
            <div class="usuarioVacacion">Usuario: ${vacation.user_name || 'N/A'}</div>
            <div class="usuarioVacacion">Equipo: ${vacation.user_team || 'N/A'}</div>
            <div class="usuarioVacacion">Supervisor: ${vacation.user_leader || 'N/A'}</div>
            <div class="observacionesVacacion">Observaciones: ${vacation.vacation_observations || 'N/A'}</div>
        </div>
    `).join('');
}

function populateTeamSelects(teams) {
    const teamSelects = document.querySelectorAll('select[id*="desplegablePorEquipo"]');
    
    teamSelects.forEach(select => {
        const currentValue = select.value;
        select.innerHTML = '<option value="">-- Selecciona un equipo --</option>';
        
        teams.forEach(team => {
            const option = document.createElement('option');
            option.value = team;
            option.textContent = team;
            if (team === currentValue) option.selected = true;
            select.appendChild(option);
        });
    });
}

function populateUserSelects(users) {
    const userSelects = document.querySelectorAll('select[id*="desplegablePorUsuario"]');
    
    userSelects.forEach(select => {
        const currentValue = select.value;
        select.innerHTML = '<option value="">-- Selecciona un usuario --</option>';
        
        users.forEach(user => {
            const option = document.createElement('option');
            option.value = user.user_id;
            option.textContent = `${user.user_name} (${user.user_meli})`;
            if (user.user_id == currentValue) option.selected = true;
            select.appendChild(option);
        });
    });
}

function showLoading(containerId) {
    const container = document.getElementById(containerId);
    if (container) {
        container.innerHTML = '<div class="loading">Cargando...</div>';
    }
}

// ============================================
// GESTIÓN DE FORMULARIOS
// ============================================

function setupFormHandlers() {
    // Formularios de agregar
    setupFormSubmission('formularioAgregarUsuario', handleAddUser);
    setupFormSubmission('formularioAgregarAusencia', handleAddAbsence);
    setupFormSubmission('formularioAgregarVacacion', handleAddVacation);
    
    // Formularios de modificar
    setupFormSubmission('formularioModificarUsuario', handleModifyUser);
    setupFormSubmission('formularioModificarAusencia', handleModifyAbsence);
    setupFormSubmission('formularioModificarVacacion', handleModifyVacation);
    
    // Botones de eliminar
    setupDeleteHandlers();
    
    // Filtros de equipos y usuarios
    setupFilterHandlers();
}

function setupFormSubmission(formClass, handler) {
    const form = document.querySelector(`.${formClass}`);
    if (form) {
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            const formData = new FormData(form);
            const data = Object.fromEntries(formData.entries());
            handler(data, form);
        });
    }
}

// ============================================
// HANDLERS DE FORMULARIOS
// ============================================

function handleAddUser(data, form) {
    console.log('Agregando usuario:', data);
    
    google.script.run
        .withSuccessHandler(function(newId) {
            showNotification('Usuario agregado correctamente con ID: ' + newId, 'success');
            form.reset();
            loadUsers();
        })
        .withFailureHandler(function(error) {
            console.error('Error creando usuario:', error);
            showNotification('Error al agregar usuario: ' + error.message, 'error');
        })
        .createUser(data);
}

function handleModifyUser(data, form) {
    const userId = getCurrentSelectedUserId('modify');
    if (!userId) {
        showNotification('Por favor selecciona un usuario para modificar', 'error');
        return;
    }
    
    console.log('Modificando usuario:', userId, data);
    
    google.script.run
        .withSuccessHandler(function(success) {
            if (success) {
                showNotification('Usuario modificado correctamente', 'success');
                loadUsers();
                clearUserDetails();
            }
        })
        .withFailureHandler(function(error) {
            console.error('Error modificando usuario:', error);
            showNotification('Error al modificar usuario: ' + error.message, 'error');
        })
        .updateUser(userId, data);
}

function handleAddAbsence(data, form) {
    const userSelect = document.getElementById('desplegablePorUsuarioAgregarAusencia');
    if (!userSelect || !userSelect.value) {
        showNotification('Por favor selecciona un usuario para la ausencia', 'error');
        return;
    }
    
    data.user_id = parseInt(userSelect.value);
    console.log('Agregando ausencia:', data);
    
    google.script.run
        .withSuccessHandler(function(newId) {
            showNotification('Ausencia agregada correctamente con ID: ' + newId, 'success');
            form.reset();
            loadAbsences();
            clearAbsenceSelects();
        })
        .withFailureHandler(function(error) {
            console.error('Error creando ausencia:', error);
            showNotification('Error al agregar ausencia: ' + error.message, 'error');
        })
        .createAbsence(data);
}

function handleModifyAbsence(data, form) {
    const absenceId = getCurrentSelectedAbsenceId('modify');
    if (!absenceId) {
        showNotification('Por favor selecciona una ausencia para modificar', 'error');
        return;
    }
    
    const userSelect = document.getElementById('desplegablePorUsuarioModificarAusencia');
    if (userSelect && userSelect.value) {
        data.user_id = parseInt(userSelect.value);
    }
    
    console.log('Modificando ausencia:', absenceId, data);
    
    google.script.run
        .withSuccessHandler(function(success) {
            if (success) {
                showNotification('Ausencia modificada correctamente', 'success');
                loadAbsences();
                clearAbsenceDetails();
            }
        })
        .withFailureHandler(function(error) {
            console.error('Error modificando ausencia:', error);
            showNotification('Error al modificar ausencia: ' + error.message, 'error');
        })
        .updateAbsence(absenceId, data);
}

function handleAddVacation(data, form) {
    const userSelect = document.getElementById('desplegablePorUsuarioAgregarVacacion');
    if (!userSelect || !userSelect.value) {
        showNotification('Por favor selecciona un usuario para las vacaciones', 'error');
        return;
    }
    
    data.user_id = parseInt(userSelect.value);
    console.log('Agregando vacación:', data);
    
    google.script.run
        .withSuccessHandler(function(newId) {
            showNotification('Vacación agregada correctamente con ID: ' + newId, 'success');
            form.reset();
            loadVacations();
            clearVacationSelects();
        })
        .withFailureHandler(function(error) {
            console.error('Error creando vacación:', error);
            showNotification('Error al agregar vacación: ' + error.message, 'error');
        })
        .createVacation(data);
}

function handleModifyVacation(data, form) {
    const vacationId = getCurrentSelectedVacationId('modify');
    if (!vacationId) {
        showNotification('Por favor selecciona una vacación para modificar', 'error');
        return;
    }
    
    const userSelect = document.getElementById('desplegablePorUsuarioModificarVacacion');
    if (userSelect && userSelect.value) {
        data.user_id = parseInt(userSelect.value);
    }
    
    console.log('Modificando vacación:', vacationId, data);
    
    google.script.run
        .withSuccessHandler(function(success) {
            if (success) {
                showNotification('Vacación modificada correctamente', 'success');
                loadVacations();
                clearVacationDetails();
            }
        })
        .withFailureHandler(function(error) {
            console.error('Error modificando vacación:', error);
            showNotification('Error al modificar vacación: ' + error.message, 'error');
        })
        .updateVacation(vacationId, data);
}

// ============================================
// GESTIÓN DE ELIMINACIÓN
// ============================================

function setupDeleteHandlers() {
    const deleteButtons = [
        { btn: 'botonEliminarUsuario', type: 'usuario' },
        { btn: 'botonEliminarAusencia', type: 'ausencia' },
        { btn: 'botonEliminarVacacion', type: 'vacacion' }
    ];
    
    deleteButtons.forEach(item => {
        const button = document.querySelector(`.${item.btn}`);
        if (button) {
            button.addEventListener('click', () => {
                handleDelete(item.type);
            });
        }
    });
}

function handleDelete(type) {
    if (type === 'usuario') {
        const userId = getCurrentSelectedUserId('delete');
        if (!userId) {
            showNotification('Por favor selecciona un usuario para eliminar', 'error');
            return;
        }
        
        if (confirm('¿Estás seguro de que quieres eliminar este usuario? Esta acción no se puede deshacer.')) {
            google.script.run
                .withSuccessHandler(function(success) {
                    if (success) {
                        showNotification('Usuario eliminado correctamente', 'success');
                        loadUsers();
                        clearSelectedItem();
                    }
                })
                .withFailureHandler(function(error) {
                    console.error('Error eliminando usuario:', error);
                    showNotification('Error al eliminar usuario: ' + error.message, 'error');
                })
                .deleteUser(userId);
        }
    } else if (type === 'ausencia') {
        const absenceId = getCurrentSelectedAbsenceId('delete');
        if (!absenceId) {
            showNotification('Por favor selecciona una ausencia para eliminar', 'error');
            return;
        }
        
        if (confirm('¿Estás seguro de que quieres eliminar esta ausencia? Esta acción no se puede deshacer.')) {
            google.script.run
                .withSuccessHandler(function(success) {
                    if (success) {
                        showNotification('Ausencia eliminada correctamente', 'success');
                        loadAbsences();
                        clearSelectedItem();
                    }
                })
                .withFailureHandler(function(error) {
                    console.error('Error eliminando ausencia:', error);
                    showNotification('Error al eliminar ausencia: ' + error.message, 'error');
                })
                .deleteAbsence(absenceId);
        }
    } else if (type === 'vacacion') {
        const vacationId = getCurrentSelectedVacationId('delete');
        if (!vacationId) {
            showNotification('Por favor selecciona una vacación para eliminar', 'error');
            return;
        }
        
        if (confirm('¿Estás seguro de que quieres eliminar esta vacación? Esta acción no se puede deshacer.')) {
            google.script.run
                .withSuccessHandler(function(success) {
                    if (success) {
                        showNotification('Vacación eliminada correctamente', 'success');
                        loadVacations();
                        clearSelectedItem();
                    }
                })
                .withFailureHandler(function(error) {
                    console.error('Error eliminando vacación:', error);
                    showNotification('Error al eliminar vacación: ' + error.message, 'error');
                })
                .deleteVacation(vacationId);
        }
    }
}

// ============================================
// GESTIÓN DE FILTROS
// ============================================

function setupFilterHandlers() {
    const teamSelects = document.querySelectorAll('select[id*="desplegablePorEquipo"]');
    const userSelects = document.querySelectorAll('select[id*="desplegablePorUsuario"]');
    
    teamSelects.forEach(select => {
        select.addEventListener('change', (e) => {
            const selectedTeam = e.target.value;
            const correspondingUserSelect = findCorrespondingUserSelect(e.target.id);
            
            if (correspondingUserSelect) {
                filterUsersByTeam(selectedTeam, correspondingUserSelect);
            }
            
            applyTeamFilter(selectedTeam, e.target.id);
        });
    });
    
    userSelects.forEach(select => {
        select.addEventListener('change', (e) => {
            const selectedUser = e.target.value;
            applyUserFilter(selectedUser, e.target.id);
        });
    });
}

function findCorrespondingUserSelect(teamSelectId) {
    const mapping = {
        'desplegablePorEquipoUsuarios': 'desplegablePorUsuarioUsuarios',
        'desplegablePorEquipoAusencias': 'desplegablePorUsuarioAusencias',
        'desplegablePorEquipoVacaciones': 'desplegablePorUsuarioVacaciones',
        'desplegablePorEquipoAgregarAusencia': 'desplegablePorUsuarioAgregarAusencia',
        'desplegablePorEquipoModificarUsuario': 'desplegablePorUsuarioModificarUsuario',
        'desplegablePorEquipoModificarAusencia': 'desplegablePorUsuarioModificarAusencia',
        'desplegablePorEquipoEliminarUsuario': 'desplegablePorUsuarioEliminarUsuario',
        'desplegablePorEquipoEliminarAusencia': 'desplegablePorUsuarioEliminarAusencia',
        'desplegablePorEquipoAgregarVacacion': 'desplegablePorUsuarioAgregarVacacion',
        'desplegablePorEquipoModificarVacacion': 'desplegablePorUsuarioModificarVacacion',
        'desplegablePorEquipoEliminarVacacion': 'desplegablePorUsuarioEliminarVacacion'
    };
    
    const userSelectId = mapping[teamSelectId];
    return userSelectId ? document.getElementById(userSelectId) : null;
}

function filterUsersByTeam(teamName, userSelect) {
    if (!userSelect) return;
    
    userSelect.innerHTML = '<option value="">-- Selecciona un usuario --</option>';
    
    if (!teamName) return;
    
    google.script.run
        .withSuccessHandler(function(users) {
            const filteredUsers = users.filter(user => user.user_team === teamName);
            
            filteredUsers.forEach(user => {
                const option = document.createElement('option');
                option.value = user.user_id;
                option.textContent = `${user.user_name} (${user.user_meli})`;
                userSelect.appendChild(option);
            });
        })
        .withFailureHandler(function(error) {
            console.error('Error filtrando usuarios por equipo:', error);
        })
        .getAllUsers();
}

function applyTeamFilter(teamId, selectId) {
    console.log(`Aplicando filtro de equipo: ${teamId} desde ${selectId}`);
    
    if (selectId.includes('Vacaciones') || selectId.includes('Vacacion')) {
        filterVacationsByTeam(teamId);
    } else if (selectId.includes('Ausencias') || selectId.includes('Ausencia')) {
        filterAbsencesByTeam(teamId);
    } else {
        filterUsersByTeamDisplay(teamId);
    }
}

function applyUserFilter(userId, selectId) {
    console.log(`Aplicando filtro de usuario: ${userId} desde ${selectId}`);
    
    if (selectId.includes('Vacaciones') || selectId.includes('Vacacion')) {
        if (selectId.includes('Modificar') || selectId.includes('Eliminar')) {
            loadVacationData(userId, selectId);
        } else {
            filterVacationsByUser(userId);
        }
    } else if (selectId.includes('Ausencias') || selectId.includes('Ausencia')) {
        if (selectId.includes('Modificar') || selectId.includes('Eliminar')) {
            loadAbsenceData(userId, selectId);
        } else {
            filterAbsencesByUser(userId);
        }
    } else {
        if (selectId.includes('Modificar') || selectId.includes('Eliminar')) {
            loadUserData(userId, selectId);
        }
    }
}

function filterUsersByTeamDisplay(teamId) {
    if (!teamId) {
        loadUsers();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(users) {
            const filteredUsers = users.filter(user => user.user_team === teamId);
            displayUsers(filteredUsers);
        })
        .withFailureHandler(function(error) {
            console.error('Error filtrando usuarios por equipo:', error);
        })
        .getAllUsers();
}

function filterAbsencesByTeam(teamName) {
    if (!teamName) {
        loadAbsences();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(absences) {
            displayAbsences(absences);
        })
        .withFailureHandler(function(error) {
            console.error('Error filtrando ausencias por equipo:', error);
            showNotification('Error al filtrar ausencias: ' + error.message, 'error');
        })
        .getAbsencesByTeam(teamName);
}

function filterAbsencesByUser(userId) {
    if (!userId) {
        loadAbsences();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(absences) {
            displayAbsences(absences);
        })
        .withFailureHandler(function(error) {
            console.error('Error filtrando ausencias por usuario:', error);
            showNotification('Error al filtrar ausencias: ' + error.message, 'error');
        })
        .getAbsencesByUserId(userId);
}

function filterVacationsByTeam(teamName) {
    if (!teamName) {
        loadVacations();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(vacations) {
            displayVacations(vacations);
        })
        .withFailureHandler(function(error) {
            console.error('Error filtrando vacaciones por equipo:', error);
            showNotification('Error al filtrar vacaciones: ' + error.message, 'error');
        })
        .getVacationsByTeam(teamName);
}

function filterVacationsByUser(userId) {
    if (!userId) {
        loadVacations();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(vacations) {
            displayVacations(vacations);
        })
        .withFailureHandler(function(error) {
            console.error('Error filtrando vacaciones por usuario:', error);
            showNotification('Error al filtrar vacaciones: ' + error.message, 'error');
        })
        .getVacationsByUserId(userId);
}

// ============================================
// FUNCIONES DE CARGA DE DATOS ESPECÍFICOS
// ============================================

function loadUserData(userId, selectId) {
    if (!userId) {
        clearUserDetails();
        return;
    }
    
    loadUserDetails(userId);
}

function loadUserDetails(userId) {
    if (!userId) {
        clearUserDetails();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(user) {
            if (user) {
                fillModifyUserForm(user);
                displayUserCard(user);
                setCurrentSelectedUserId(userId);
            } else {
                showNotification('Usuario no encontrado', 'error');
                clearUserDetails();
            }
        })
        .withFailureHandler(function(error) {
            console.error('Error cargando detalles del usuario:', error);
            showNotification('Error al cargar usuario: ' + error.message, 'error');
            clearUserDetails();
        })
        .getUserById(userId);
}

function loadAbsenceData(userId, selectId) {
    if (!userId) {
        clearAbsenceDetails();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(absences) {
            if (absences && absences.length > 0) {
                const absence = absences[0];
                
                if (selectId.includes('Modificar')) {
                    fillModifyAbsenceForm(absence);
                    setCurrentSelectedAbsenceId(absence.absence_id, 'modify');
                } else if (selectId.includes('Eliminar')) {
                    displayAbsenceCard(absence);
                    setCurrentSelectedAbsenceId(absence.absence_id, 'delete');
                }
            } else {
                showNotification('No se encontraron ausencias para este usuario', 'error');
                clearAbsenceDetails();
            }
        })
        .withFailureHandler(function(error) {
            console.error('Error cargando ausencias del usuario:', error);
            showNotification('Error al cargar ausencias: ' + error.message, 'error');
            clearAbsenceDetails();
        })
        .getAbsencesByUserId(userId);
}

function loadVacationData(userId, selectId) {
    if (!userId) {
        clearVacationDetails();
        return;
    }
    
    google.script.run
        .withSuccessHandler(function(vacations) {
            if (vacations && vacations.length > 0) {
                const vacation = vacations[0];
                
                if (selectId.includes('Modificar')) {
                    fillModifyVacationForm(vacation);
                    setCurrentSelectedVacationId(vacation.vacation_id, 'modify');
                } else if (selectId.includes('Eliminar')) {
                    displayVacationCard(vacation);
                    setCurrentSelectedVacationId(vacation.vacation_id, 'delete');
                }
            } else {
                showNotification('No se encontraron vacaciones para este usuario', 'error');
                clearVacationDetails();
            }
        })
        .withFailureHandler(function(error) {
            console.error('Error cargando vacaciones del usuario:', error);
            showNotification('Error al cargar vacaciones: ' + error.message, 'error');
            clearVacationDetails();
        })
        .getVacationsByUserId(userId);
}

// ============================================
// FUNCIONES AUXILIARES PARA USUARIOS
// ============================================

function setCurrentSelectedUserId(userId, context = 'modify') {
    selectedUserIds[context] = userId;
}

function getCurrentSelectedUserId(context = 'modify') {
    return selectedUserIds[context];
}

function clearUserDetails() {
    clearModifyUserForm();
    clearSelectedItem();
    selectedUserIds.modify = null;
    selectedUserIds.delete = null;
}

function clearModifyUserForm() {
    const form = document.querySelector('.formularioModificarUsuario');
    if (form) {
        form.reset();
    }
}

function fillModifyUserForm(userData) {
    const form = document.querySelector('.formularioModificarUsuario');
    if (!form) return;
    
    const fields = {
        'modify_user_name': userData.user_name,
        'modify_user_meli': userData.user_meli,
        'modify_user_team': userData.user_team,
        'modify_user_leader': userData.user_leader,
        'modify_user_cuil': userData.user_cuil,
        'modify_user_position': userData.user_position,
        'modify_user_mail': userData.user_mail,
        'modify_user_serial': userData.user_serial,
        'modify_user_entry_date': userData.user_entry_date,
        'modify_user_retirement_date': userData.user_retirement_date,
        'modify_user_expiration_date': userData.user_expiration_date
    };
    
    Object.keys(fields).forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && fields[fieldId]) {
            field.value = fields[fieldId];
        }
    });
}

function displayUserCard(userData) {
    const container = document.querySelector('#seccionEliminarUsuario .containerTarjetaUsuario');
    if (!container) return;
    
    container.innerHTML = `
        <div class="nombreUsuario">Nombre: ${userData.user_name || 'N/A'}</div>
        <div class="equipoUsuario">Equipo: ${userData.user_team || 'N/A'}</div>
        <div class="supervisorUsuario">Supervisor: ${userData.user_leader || 'N/A'}</div>
        <div class="nombreUsuario">User Meli: ${userData.user_meli || 'N/A'}</div>
        <div class="nombreUsuario">Posición: ${userData.user_position || 'N/A'}</div>
        <div class="nombreUsuario">Email: ${userData.user_mail || 'N/A'}</div>
    `;
    
    setCurrentSelectedUserId(userData.user_id, 'delete');
}

// ============================================
// FUNCIONES AUXILIARES PARA AUSENCIAS
// ============================================

function setCurrentSelectedAbsenceId(absenceId, context = 'modify') {
    selectedAbsenceIds[context] = absenceId;
}

function getCurrentSelectedAbsenceId(context = 'modify') {
    return selectedAbsenceIds[context];
}

function clearAbsenceDetails() {
    clearModifyAbsenceForm();
    clearAbsenceCard();
    selectedAbsenceIds.modify = null;
    selectedAbsenceIds.delete = null;
}

function clearModifyAbsenceForm() {
    const form = document.querySelector('.formularioModificarAusencia');
    if (form) {
        form.reset();
    }
}

function clearAbsenceCard() {
    const container = document.querySelector('#seccionEliminarAusencia .containerTarjetaAusencia');
    if (container) {
        container.innerHTML = '<p>Selecciona una ausencia para ver sus detalles</p>';
    }
}

function clearAbsenceSelects() {
    const selects = [
        'desplegablePorEquipoAgregarAusencia',
        'desplegablePorUsuarioAgregarAusencia'
    ];
    
    selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            select.selectedIndex = 0;
        }
    });
}

function fillModifyAbsenceForm(absenceData) {
    const form = document.querySelector('.formularioModificarAusencia');
    if (!form) return;
    
    const fields = {
        'modify_absence_detail': absenceData.absence_detail,
        'modify_absence_init_date': absenceData.absence_init_date,
        'modify_absence_end_date': absenceData.absence_end_date
    };
    
    Object.keys(fields).forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && fields[fieldId]) {
            field.value = fields[fieldId];
        }
    });
    
    const userSelect = document.getElementById('desplegablePorUsuarioModificarAusencia');
    if (userSelect && absenceData.user_id) {
        userSelect.value = absenceData.user_id;
    }
    
    const teamSelect = document.getElementById('desplegablePorEquipoModificarAusencia');
    if (teamSelect && absenceData.user_team) {
        teamSelect.value = absenceData.user_team;
    }
}

function displayAbsenceCard(absenceData) {
    const container = document.querySelector('#seccionEliminarAusencia .containerTarjetaAusencia');
    if (!container) return;
    
    container.innerHTML = `
        <div class="motivoAusencia">Motivo: ${absenceData.absence_detail || 'N/A'}</div>
        <div class="fechaInicioAusencia">Fecha Inicio: ${absenceData.absence_init_date || 'N/A'}</div>
        <div class="fechaFinAusencia">Fecha Fin: ${absenceData.absence_end_date || 'N/A'}</div>
        <div class="usuarioAusencia">Usuario: ${absenceData.user_name || 'N/A'}</div>
        <div class="usuarioAusencia">Equipo: ${absenceData.user_team || 'N/A'}</div>
        <div class="usuarioAusencia">Supervisor: ${absenceData.user_leader || 'N/A'}</div>
    `;
    
    setCurrentSelectedAbsenceId(absenceData.absence_id, 'delete');
}

// ============================================
// FUNCIONES AUXILIARES PARA VACACIONES
// ============================================

function setCurrentSelectedVacationId(vacationId, context = 'modify') {
    selectedVacationIds[context] = vacationId;
}

function getCurrentSelectedVacationId(context = 'modify') {
    return selectedVacationIds[context];
}

function clearVacationDetails() {
    clearModifyVacationForm();
    clearVacationCard();
    selectedVacationIds.modify = null;
    selectedVacationIds.delete = null;
}

function clearModifyVacationForm() {
    const form = document.querySelector('.formularioModificarVacacion');
    if (form) {
        form.reset();
    }
}

function clearVacationCard() {
    const container = document.querySelector('#seccionEliminarVacacion .containerTarjetaVacacion');
    if (container) {
        container.innerHTML = '<p>Selecciona una vacación para ver sus detalles</p>';
    }
}

function clearVacationSelects() {
    const selects = [
        'desplegablePorEquipoAgregarVacacion',
        'desplegablePorUsuarioAgregarVacacion'
    ];
    
    selects.forEach(selectId => {
        const select = document.getElementById(selectId);
        if (select) {
            select.selectedIndex = 0;
        }
    });
}

function fillModifyVacationForm(vacationData) {
    const form = document.querySelector('.formularioModificarVacacion');
    if (!form) return;
    
    const fields = {
        'modify_vacation_init_date': vacationData.vacation_init_date,
        'modify_vacation_end_date': vacationData.vacation_end_date,
        'modify_vacation_days': vacationData.vacation_days,
        'modify_vacation_observations': vacationData.vacation_observations
    };
    
    Object.keys(fields).forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field && fields[fieldId]) {
            field.value = fields[fieldId];
        }
    });
    
    const userSelect = document.getElementById('desplegablePorUsuarioModificarVacacion');
    if (userSelect && vacationData.user_id) {
        userSelect.value = vacationData.user_id;
    }
    
    const teamSelect = document.getElementById('desplegablePorEquipoModificarVacacion');
    if (teamSelect && vacationData.user_team) {
        teamSelect.value = vacationData.user_team;
    }
}

function displayVacationCard(vacationData) {
    const container = document.querySelector('#seccionEliminarVacacion .containerTarjetaVacacion');
    if (!container) return;
    
    container.innerHTML = `
        <div class="fechaInicioVacacion">Fecha Inicio: ${vacationData.vacation_init_date || 'N/A'}</div>
        <div class="fechaFinVacacion">Fecha Fin: ${vacationData.vacation_end_date || 'N/A'}</div>
        <div class="diasVacacion">Días: ${vacationData.vacation_days || 'N/A'}</div>
        <div class="usuarioVacacion">Usuario: ${vacationData.user_name || 'N/A'}</div>
        <div class="usuarioVacacion">Equipo: ${vacationData.user_team || 'N/A'}</div>
        <div class="usuarioVacacion">Supervisor: ${vacationData.user_leader || 'N/A'}</div>
        <div class="observacionesVacacion">Observaciones: ${vacationData.vacation_observations || 'N/A'}</div>
    `;
    
    setCurrentSelectedVacationId(vacationData.vacation_id, 'delete');
}

// ============================================
// FUNCIÓN UNIFICADA PARA LIMPIAR ELEMENTOS SELECCIONADOS
// ============================================

function clearSelectedItem() {
    const userContainer = document.querySelector('#seccionEliminarUsuario .containerTarjetaUsuario');
    if (userContainer) {
        userContainer.innerHTML = '<p>Selecciona un usuario para ver sus detalles</p>';
    }
    
    const absenceContainer = document.querySelector('#seccionEliminarAusencia .containerTarjetaAusencia');
    if (absenceContainer) {
        absenceContainer.innerHTML = '<p>Selecciona una ausencia para ver sus detalles</p>';
    }
    
    const vacationContainer = document.querySelector('#seccionEliminarVacacion .containerTarjetaVacacion');
    if (vacationContainer) {
        vacationContainer.innerHTML = '<p>Selecciona una vacación para ver sus detalles</p>';
    }
}

// ============================================
// SISTEMA DE NOTIFICACIONES
// ============================================

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <span>${message}</span>
        <button class="notification-close" onclick="this.parentElement.remove()">×</button>
    `;
    
    Object.assign(notification.style, {
        position: 'fixed',
        top: '20px',
        right: '20px',
        padding: '15px 20px',
        borderRadius: '8px',
        color: 'white',
        fontFamily: 'Lato, sans-serif',
        fontSize: '14px',
        zIndex: '9999',
        minWidth: '300px',
        boxShadow: '0 4px 12px rgba(0,0,0,0.2)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'space-between',
        backgroundColor: type === 'success' ? '#48bb78' : type === 'error' ? '#e53e3e' : '#4299e1'
    });
    
    const closeBtn = notification.querySelector('.notification-close');
    Object.assign(closeBtn.style, {
        background: 'none',
        border: 'none',
        color: 'white',
        fontSize: '18px',
        cursor: 'pointer',
        marginLeft: '15px'
    });
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        if (notification.parentElement) {
            notification.remove();
        }
    }, 5000);
}

// ============================================
// FUNCIONES DE CARGA DE DATOS PRINCIPALES
// ============================================

function loadUsers() {
    try {
        showLoading('containerTarjetasUsuarios');
        
        google.script.run
            .withSuccessHandler(function(users) {
                displayUsers(users);
                populateUserSelects(users);
            })
            .withFailureHandler(function(error) {
                console.error('Error cargando usuarios:', error);
                showNotification('Error al cargar usuarios: ' + error.message, 'error');
            })
            .getAllUsers();
            
    } catch (error) {
        console.error('Error en loadUsers:', error);
        showNotification('Error al cargar usuarios', 'error');
    }
}

function loadTeams() {
    try {
        google.script.run
            .withSuccessHandler(function(users) {
                const teams = [...new Set(users.map(user => user.user_team).filter(team => team))];
                populateTeamSelects(teams);
            })
            .withFailureHandler(function(error) {
                console.error('Error cargando equipos:', error);
            })
            .getAllUsers();
            
    } catch (error) {
        console.error('Error en loadTeams:', error);
    }
}

function loadAbsences() {
    try {
        showLoading('containerTarjetasAusencias');
        
        google.script.run
            .withSuccessHandler(function(absences) {
                displayAbsences(absences);
            })
            .withFailureHandler(function(error) {
                console.error('Error cargando ausencias:', error);
                showNotification('Error al cargar ausencias: ' + error.message, 'error');
            })
            .getAllAbsences();
            
    } catch (error) {
        console.error('Error en loadAbsences:', error);
        showNotification('Error al cargar ausencias', 'error');
    }
}

function loadVacations() {
    try {
        showLoading('containerTarjetasVacaciones');
        
        google.script.run
            .withSuccessHandler(function(vacations) {
                displayVacations(vacations);
            })
            .withFailureHandler(function(error) {
                console.error('Error cargando vacaciones:', error);
                showNotification('Error al cargar vacaciones: ' + error.message, 'error');
            })
            .getAllVacations();
            
    } catch (error) {
        console.error('Error en loadVacations:', error);
        showNotification('Error al cargar vacaciones', 'error');
    }
}

// ============================================
// FUNCIÓN API GENÉRICA (PARA USO FUTURO)
// ============================================

async function apiCall(endpoint, method = 'GET', data = null) {
    try {
        const config = {
            method,
            headers: {
                'Content-Type': 'application/json'
            }
        };
        
        if (data && (method === 'POST' || method === 'PUT')) {
            config.body = JSON.stringify(data);
        }
        
        const response = await fetch(endpoint, config);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    } catch (error) {
        console.error('API call error:', error);
        showNotification(`Error: ${error.message}`, 'error');
        throw error;
    }
}

</script>
</body>
</html>